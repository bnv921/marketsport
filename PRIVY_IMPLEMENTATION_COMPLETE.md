# Privy –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ú–æ–¥—É–ª—å Privy Signer
**–§–∞–π–ª:** `/backend/app/polymarket/privy_signer.py`

–°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Privy:
- `PrivySigner` –∫–ª–∞—Å—Å - wrapper –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —á–µ—Ä–µ–∑ Privy API
- `get_user_signer_via_privy_api()` - –ø–æ–ª—É—á–µ–Ω–∏–µ signer —á–µ—Ä–µ–∑ Privy REST API
- `get_user_signer_from_frontend_signature()` - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –æ—Ç frontend

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_user_signer()`
**–§–∞–π–ª:** `/backend/app/polymarket/user_clob_client.py`

–¢–µ–ø–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏—è:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Privy REST API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ wallet
- –ü—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å signer –∏–∑ wallet –¥–∞–Ω–Ω—ã—Ö
- –ò–º–µ–µ—Ç fallback –Ω–∞ `get_user_signer_via_privy_api()`
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 3. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–§–∞–π–ª:** `/backend/app/core/config.py`

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- `PRIVY_APP_ID` - ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Privy
- `PRIVY_APP_SECRET` - Secret –¥–ª—è server-side –¥–æ—Å—Ç—É–ø–∞
- `PRIVY_API_URL` - URL Privy API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: https://auth.privy.io/api/v1)

### 4. –û–±–Ω–æ–≤–ª–µ–Ω env.template
**–§–∞–π–ª:** `/backend/env.template`

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è Privy.

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
**–§–∞–π–ª—ã:**
- `/backend/PRIVY_SETUP.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- `/backend/PRIVY_INTEGRATION.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ Privy credentials

1. –ó–∞–π–¥–∏—Ç–µ –≤ Privy Dashboard: https://dashboard.privy.io
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **App ID** (–æ–±—ã—á–Ω–æ `clxxxxx...`)
   - **App Secret** (–≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

### –®–∞–≥ 2: –î–æ–±–∞–≤—å—Ç–µ –≤ .env

```env
PRIVY_APP_ID=your_privy_app_id
PRIVY_APP_SECRET=your_privy_app_secret
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

```bash
sudo systemctl restart marketsport-backend
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –î–ª—è Embedded Wallets

Privy —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª—é—á–∞–º–∏ –¥–ª—è embedded wallets –Ω–∞ —Å–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

1. **Backend –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ private key**
2. **–ü–æ–¥–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑:**
   - Privy's signing API (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
   - –ò–ª–∏ frontend, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Privy SDK

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—ã—Ç–∞–µ—Ç—Å—è:
1. –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ wallet —á–µ—Ä–µ–∑ Privy API
2. –°–æ–∑–¥–∞—Ç—å signer wrapper –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å wallet

**–û–¥–Ω–∞–∫–æ**, –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ wallet.

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–±–æ—Ç—ã —Å embedded wallets

#### –í–∞—Ä–∏–∞–Ω—Ç A: Frontend Signing (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
Frontend –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—è Privy SDK, backend –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç:

```typescript
// Frontend
const { signMessage } = usePrivy();
const signature = await signMessage(message);
// –û—Ç–ø—Ä–∞–≤–∏—Ç—å signature –Ω–∞ backend
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Privy Signing API
–ï—Å–ª–∏ Privy –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç server-side signing API, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ.

#### –í–∞—Ä–∏–∞–Ω—Ç C: Export Private Key (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç private key, –µ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   curl http://localhost:8000/api/auth/me \
     -H "Authorization: Bearer <jwt>"
   ```

2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ enable-trading:**
   ```bash
   curl -X POST http://localhost:8000/api/polymarket/enable-trading \
     -H "Authorization: Bearer <jwt>"
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   sudo journalctl -u marketsport-backend -f
   ```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Privy credentials** –≤ `.env`
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ enable-trading** endpoint
3. **–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏** –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥ –≤–∞—à —Ç–∏–ø wallet (EOA vs embedded)
4. **–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ frontend signing** –¥–ª—è embedded wallets

## üîç Troubleshooting

### "Privy integration not configured"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `PRIVY_APP_SECRET` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

### "Could not get L1 signer"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ credentials –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç connected wallet
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

### "Privy API error: 401"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç `PRIVY_APP_SECRET`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π App ID

