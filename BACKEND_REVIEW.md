# –ê—É–¥–∏—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ü–µ–ø–æ—á–∫–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ Polymarket

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ç–∞ —á–µ—Ä–µ–∑ Gamma Events API
- ‚úÖ `market_client.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `https://gamma-api.polymarket.com/events/slug/{slug}`
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏—Ç `clobTokenIds` –∏–∑ JSON-—Å—Ç—Ä–æ–∫–∏
- ‚úÖ –ò–∑–≤–ª–µ–∫–∞–µ—Ç `tokenId` –∏ `homeTokenId` –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –Ω—É–∂–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

### 2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Privy
- ‚úÖ Endpoint `/api/auth/privy-login` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `did` –∏ `wallet`
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Å `did` –≤ payload
- ‚úÖ `get_current_user` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ JWT

### 3. Builder Headers
- ‚úÖ `builder_headers.py` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç builder headers –¥–ª—è –∞—Ç—Ä–∏–±—É—Ü–∏–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `POLY_BUILDER_KEY`, `POLY_BUILDER_SECRET`, `POLY_BUILDER_PASSPHRASE`

## ‚ùå –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:

### 1. –ù–µ—Ç endpoint –¥–ª—è Enable Trading
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `/api/polymarket/enable-trading` endpoint

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –°–æ–∑–¥–∞—Ç—å endpoint `POST /api/polymarket/enable-trading`
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å `ClobClient` —Å L1 signer –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í—ã–∑–≤–∞—Ç—å `create_or_derive_api_creds()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è L2 API creds
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å L2 creds –≤ –ë–î –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 2. –ù–µ—Ç –º–æ–¥–µ–ª–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è L2 API Creds
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–æ–¥–µ–ª–∏ `User` –Ω–µ—Ç –ø–æ–ª–µ–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è L2 API creds

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—å `User`:
  - `clob_api_key` (String, nullable)
  - `clob_api_secret` (String, nullable) 
  - `clob_api_passphrase` (String, nullable)
  - `trading_enabled` (Boolean, default=False)
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –º–æ–¥–µ–ª—å `UserClobCreds`

### 3. CLOB Client –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç py-clob-client –ø—Ä–∞–≤–∏–ª—å–Ω–æ
**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—É—â–∏–π `PolymarketCLOBClient` - —ç—Ç–æ –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ HTTP –∑–∞–ø—Ä–æ—Å–∞–º–∏, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `py_clob_client.ClobClient`

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `get_user_clob_client(user: User)` –∫–æ—Ç–æ—Ä–∞—è:
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `ClobClient` —Å L1 signer –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç L2 API creds —á–µ—Ä–µ–∑ `set_api_creds()`
  - –î–æ–±–∞–≤–ª—è–µ—Ç builder headers –¥–ª—è –∞—Ç—Ä–∏–±—É—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π `py_clob_client.ClobClient` –≤–º–µ—Å—Ç–æ —Å–∞–º–æ–ø–∏—Å–Ω–æ–π –æ–±–µ—Ä—Ç–∫–∏

### 4. Place Order –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π client
**–ü—Ä–æ–±–ª–µ–º–∞:** `POST /api/polymarket/orders` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π `clob_client`, –∞ –Ω–µ user-specific

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –í `create_order` endpoint:
  - –ü–æ–ª—É—á–∏—Ç—å user-specific `ClobClient` —á–µ—Ä–µ–∑ `get_user_clob_client(current_user)`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã `create_order()` –∏ `post_order()` –∏–∑ `py_clob_client`
  - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ builder headers –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 5. –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å L1 Signer
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–æ–ª—É—á–µ–Ω–∏—è L1 signer –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å Privy/Turnkey –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è signer
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å embedded wallet —á–µ—Ä–µ–∑ Privy SDK
- L1 signer –Ω—É–∂–µ–Ω –¥–ª—è:
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `ClobClient`
  - Derivation L2 API creds
  - –ü–æ–¥–ø–∏—Å–∏ –æ—Ä–¥–µ—Ä–æ–≤

### 6. Builder Headers –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å ClobClient
**–ü—Ä–æ–±–ª–µ–º–∞:** Builder headers –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å `ClobClient`

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `ClobClient` —á—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–ª builder headers –∫ –∑–∞–ø—Ä–æ—Å–∞–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `py_builder_signing_sdk` –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–æ–¥–ø–∏—Å—å
- Builder headers –¥–æ–ª–∂–Ω—ã –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∫ `post_order()` –∑–∞–ø—Ä–æ—Å–∞–º

## üìã –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è L2 API Creds**
   - –†–∞—Å—à–∏—Ä–∏—Ç—å `User` –º–æ–¥–µ–ª—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å `UserClobCreds`
   - –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

2. **–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è L1 Signer**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Privy –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è signer
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ embedded wallet

3. **–°–æ–∑–¥–∞—Ç—å `get_user_clob_client()` —Ñ—É–Ω–∫—Ü–∏—é**
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `ClobClient` —Å user L1 signer
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ L2 API creds
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ builder headers

4. **–°–æ–∑–¥–∞—Ç—å endpoint `/api/polymarket/enable-trading`**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ L1 signer
   - –°–æ–∑–¥–∞–Ω–∏–µ/derivation L2 API creds
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
   - –í–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞—Ç—É—Å–∞

5. **–û–±–Ω–æ–≤–∏—Ç—å `POST /api/polymarket/orders`**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_user_clob_client(current_user)`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –∏–∑ `py_clob_client`
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ trading enabled

6. **–û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/api/polymarket/market`**
   - –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –º–∞—Å—Å–∏–≤ markets —Å outcomes –∏ tokenIds
   - –§–æ—Ä–º–∞—Ç: `{ "eventSlug": "...", "markets": [{ "id": "...", "type": "moneyline", "outcomes": [...] }] }`

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `py_clob_client` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`py_order_utils`, `py_builder_signing_sdk`)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ builder headers —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ L2 API creds –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã?)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ L1 signer –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏–∑ Privy

